<!DOCTYPE html>
<html>
<head>
    <title>Snake Empire: Gold Edition</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; color: #FFD700; font-family: sans-serif; overflow: hidden; touch-action: manipulation; }
        canvas { border: 3px solid #FFD700; background: #050505; border-radius: 10px; }
        .score { font-size: 24px; margin-bottom: 10px; }
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .btn { width: 60px; height: 60px; background: #333; border: 2px solid #FFD700; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: gold; font-size: 24px; cursor: pointer; user-select: none; }
    </style>
</head>
<body>
    <div class="score"><span id="scoreVal">0</span> MONEY</div>
    <canvas id="gameCanvas" width="300" height="300"></canvas>

    <div class="controls">
        <div class="btn up" onclick="changeDir('UP')">▲</div>
        <div class="btn left" onclick="changeDir('LEFT')">◀</div>
        <div class="btn down" onclick="changeDir('DOWN')">▼</div>
        <div class="btn right" onclick="changeDir('RIGHT')">▶</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; // Инициализация WebApp
        tg.expand(); // Развернуть на весь экран

        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreElement = document.getElementById("scoreVal");

        let score = 0;
        let snake = [{x: 100, y: 100}, {x: 80, y: 100}, {x: 60, y: 100}];
        let dx = 20; let dy = 0;
        let foodX; let foodY;

        function main() {
            if (didGameEnd()) {
                // ОТПРАВЛЯЕМ ДАННЫЕ БОТУ ПРИ ПРОИГРЫШЕ
                tg.sendData(score.toString()); 
                tg.close(); // Закрываем игру
                return;
            }
            setTimeout(function onTick() {
                clearCanvas(); drawFood(); advanceSnake(); drawSnake(); main();
            }, 150);
        }

        function clearCanvas() { ctx.fillStyle = "#050505"; ctx.fillRect(0, 0, canvas.width, canvas.height); }

        function drawSnake() {
            snake.forEach((part, index) => {
                ctx.fillStyle = index === 0 ? "#FFD700" : "#DAA520";
                ctx.fillRect(part.x, part.y, 18, 18);
            });
        }

        function advanceSnake() {
            const head = {x: snake[0].x + dx, y: snake[0].y + dy};
            snake.unshift(head);
            if (snake[0].x === foodX && snake[0].y === foodY) {
                score += 10;
                scoreElement.innerHTML = score;
                createFood();
            } else { snake.pop(); }
        }

        function didGameEnd() {
            for (let i = 4; i < snake.length; i++) {
                if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) return true;
            }
            return snake[0].x < 0 || snake[0].x > canvas.width - 20 || snake[0].y < 0 || snake[0].y > canvas.height - 20;
        }

        function createFood() {
            foodX = Math.floor(Math.random() * (canvas.width/20)) * 20;
            foodY = Math.floor(Math.random() * (canvas.height/20)) * 20;
        }

        function drawFood() {
            ctx.fillStyle = "#00FF00";
            ctx.beginPath(); ctx.arc(foodX + 10, foodY + 10, 8, 0, 2 * Math.PI); ctx.fill();
        }

        function changeDir(dir) {
            if (dir === 'LEFT' && dx === 0) { dx = -20; dy = 0; }
            if (dir === 'UP' && dy === 0) { dx = 0; dy = -20; }
            if (dir === 'RIGHT' && dx === 0) { dx = 20; dy = 0; }
            if (dir === 'DOWN' && dy === 0) { dx = 0; dy = 20; }
        }

        createFood();
        main();
    </script>
</body>
</html>
